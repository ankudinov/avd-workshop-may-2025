---
marp: true
theme: jobs
author: Petr Ankudinov
size: 16:9
paginate: true
math: mathjax
style: |
    img[alt~="custom"] {
      float: right;
    }
    .columns {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 1rem;
    }
    .columns3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 1rem;
    }
    footer {
      font-size: 14px;
    }
    section::after {
      font-size: 14px;
    }
    img {
      background-color: transparent;
    }
    img[alt~="center"] {
      display: block;
      margin: 0 auto;
    }

---

# WS:D3 - Arista AVD: Architect, Validate, and Deploy

![bg right:25% fit](img/avd-logo-new.png)

> Build, deploy and test L3LS EVPN with Arista AVD

<style scoped>section {font-size: 22px;}</style>

<!-- Do not add page number on this slide -->
<!--
_paginate: false
-->

```python
#!/usr/bin/env python3

__author__ = [
  "Petr Ankudinov (pa@), Senior Solutions Engineer",
  "Guillaume Mulocher (gmulocher@), Senior Solutions Engineer",
  "Patrick Prangl (pprangl@), Systems Engineer"
]
```

```bash
$ date +"%b %Y"                 
May 2025
```

<!-- Add footer starting from this slide -->
<!--
footer: '![h:20](https://www.arista.com/assets/images/logo/Arista_Logo.png)'
-->

---

# Credits

<style scoped>section {font-size: 24px;}</style>

![bg right:35% fit vertical](img/marp.png)
![bg right:35% w:250](img/slides-qr.png)

- Slides are created in [Marp](https://github.com/marp-team/marp) by Yuki Hattori
- Why:
  - Easy to build and share, rich content
  - Also ask yourself why people are presenting in PowerPoint when it comes to automation event. Slides are just another form of Markdown content build by CI.
- Check [Marp awesome list](https://github.com/marp-team/awesome-marp) and build your next slide deck in Marp!
- Most images are from [Pexels](https://www.pexels.com/) or generated by AI

> Scan QR code to access the slide deck.

---

# Agenda

- IaC & network-wide data models w/ VSCode, Git, and AVD
- Initial deployment (Day 0 provisioning)
- Ongoing operations (Day 2 and beyond) of an L3 leaf and spine EVPN/VXLAN fabric.
- Arista Network to Test Automation (ANTA) network validation

![bg left](img/pexels-suzy-hazelwood-1226398.jpg)

---

# What is AVD

![bg right:40% fit](img/avd-roles-overview-transparent.png)

<style scoped>section {font-size: 18px;}</style>

- [AVD is an open-source project](https://avd.arista.com)
- AVD stands for "Architect, Validate, and Deploy"
- [Supported designs](https://avd.arista.com/5.2/ansible_collections/arista/avd/roles/eos_designs/index.html) as of AVD 5.2:
  - L3LS EVPN / L2LS / MPLS / Campus
  - WAN AutoVPN/CV Pathfinder
- Roles:
  - `arista.avd.eos_designs` - abstracted to low level variables
  - `arista.avd.cli_config_gen` - parse templates to build plain text configs
  - `arista.avd.cv_deploy` - push configurations to Arista CloudVision Portal (replaced `eos_config_deploy_cvp`)
  - `arista.avd.eos_config_deploy_eapi` - push configs to switches directly. Based on [`arista.eos.eos_config`](https://docs.ansible.com/ansible/latest/collections/arista/eos/eos_config_module.html). [`arista.eos`](https://galaxy.ansible.com/arista/eos) is maintained by RedHat ‚ö†Ô∏è
  - `arista.avd.eos_validate_state` - validate operational state of Arista EOS devices (with ANTA)

---

# AVD is Open Source

![bg right:20% fit](img/pexels-markus-winkler-1430818-12081252.jpg)

- AVD was started by Arista community and for Arista community
- Open source means that you can use it for free and have full power as long as you take the responsibility of a power user:
  - Understand and troubleshoot
  - Be part of the community - share your feedback, open Github issues and even PRs

AVD commercial traits:

- Large maintainers team
- Option to buy [A-Care TAC support](https://avd.arista.com/5.4/docs/support/support_overview.html) to fullfil highest expectations

---

![bg](img/arista-open-ci.png)

---

# ATD (Arista Test Drive) Lab

<style scoped>section {font-size: 24px;}</style>
<style scoped>p {font-size: 24px;}</style>

![bg right fit](img/l3ls_topo_overview.png)

- You can access the lab guides on [https://labguides.testdrive.arista.com/](https://labguides.testdrive.arista.com/)
- Click [this URL](to-be-defined) to get your lab copy
- Start the lab and wait until it's ready

> While the lab is starting... ‚è≤Ô∏è Let's discuss how to create your own AVD environment.

`Quiz`: AVD / ATD / ACT / ACB / ABC - which one is not valid Arista abbreviation. üòÑ

---

# AVD Installation Options

<style scoped>section {font-size: 24px;}</style>

<div class="columns">
<div>

- Ansible CE (Community Edition)
  - free to use
  - check [AVD docs](https://avd.arista.com/) for the installation manual
- Ansible Automation Platform
  - paid RedHat support
  - check [AAP guide here](https://avd.arista.com/devel/docs/getting-started/avd-aap.html)
  - out of scope

</div>
<div>

After 4.9 (PyAVD is the foundation ‚ö†Ô∏è)

```bash
# ansible-core will be installed as PyAVD requirement
pip install "pyavd[ansible]"
ansible-galaxy collection install arista.avd
# install community.general to support callback plugins, etc.
ansible-galaxy collection install community.general
```

- ‚ö†Ô∏è [PyAVD](https://pypi.org/project/pyavd/) is not intended to be used directly
- Ansible provides a lot of value, for ex. inventory management - use Ansible ‚ö†Ô∏è
- However PyAVD is the foundation that allows to solve a lot of Ansible shortcomings

</div>
</div>

---

# Virtual Environment vs Containers

<!-- Do not add page number on this slide -->
<!--
class: invert
-->

<style scoped>section {font-size: 22px;}</style>

<div class="columns">
<div>

venv/pyenv üì¶

- Pro:
  - simple and lightweight
  - no special tools required
- Breaks **often**. Troubleshooting complexity: **average**
- How it breaks:
  - multiple Pythons
  - incorrect requirements installation
  - broken path, custom ansible.cfg, tweaks, etc.
  - `../../../<ansible-collection>` ü§¶ üôà

</div>
<div>

Containers üê≥

- Pro:
  - stable, portable
  - high level of isolation
- Breaks **rarely**. Troubleshooting complexity: **high**
- How it breaks:
  - permission issues üëë
    - check [this document](https://code.visualstudio.com/remote/advancedcontainers/add-nonroot-user) to UID requirements
  - broken Docker installation or host OS
  - tools can be "too heavy" for some users üî®

</div>
</div>

---

# Quickest AVD Test Possible

```bash
podman run --rm -it -w /home/avd ghcr.io/aristanetworks/avd/universal:python3.11-avd-v5.4.0 \
zsh -c "cp -r /home/avd/.ansible/collections/ansible_collections/arista/avd/examples/single-dc-l3ls/* .; ansible-playbook build.yml; cat intended/configs/dc1-leaf1a.cfg"
```

ATD environment is based on the [Coder container](https://coder.com/docs/user-guides/workspace-access/vscode)

> Check appendix for details about installing container engine.

---

# Q&A

![bg left](img/pexels-valeriia-miller-3020919.jpg)

- [Ansible AVD](https://avd.arista.com/)
- [This repository](https://github.com/ankudinov/avd-workshop-may-2025)

```diff
- One more slide!
+ No more slides.
```

```bash
git commit -m "The END!"
```

<!-- Add footer starting from this slide -->
<!--
footer: '![h:20](https://www.arista.com/assets/images/logo/Arista_Logo.png)'
-->
